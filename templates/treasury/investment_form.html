{% extends 'layout.html' %}

{% block title %}{% if is_new %}New Investment{% else %}Edit Investment{% endif %}{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="{{ url_for('treasury.dashboard') }}">Treasury</a></li>
          <li class="breadcrumb-item"><a href="{{ url_for('treasury.investment_list') }}">Investments</a></li>
          <li class="breadcrumb-item active" aria-current="page">{% if is_new %}New Investment{% else %}Edit Investment{% endif %}</li>
        </ol>
      </nav>
      
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>{% if is_new %}New Investment{% else %}Edit Investment{% endif %}</h1>
        <a href="{{ url_for('treasury.investment_list') }}" class="btn btn-outline-secondary">
          <i class="fas fa-arrow-left me-1"></i> Back to List
        </a>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-8 mx-auto">
      <div class="card shadow-sm">
        <div class="card-header bg-light">
          <h5 class="mb-0">Investment Details</h5>
        </div>
        <div class="card-body">
          <form method="POST" id="investment-form">
            {{ form.hidden_tag() }}
            
            <div class="row mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  {{ form.investment_type.label(class="form-label") }}
                  {{ form.investment_type(class="form-select") }}
                  {% if form.investment_type.errors %}
                  <div class="text-danger">
                    {% for error in form.investment_type.errors %}
                    <small>{{ error }}</small>
                    {% endfor %}
                  </div>
                  {% endif %}
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="form-group">
                  {{ form.account_id.label(class="form-label") }}
                  {{ form.account_id(class="form-select") }}
                  {% if form.account_id.errors %}
                  <div class="text-danger">
                    {% for error in form.account_id.errors %}
                    <small>{{ error }}</small>
                    {% endfor %}
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
            
            <div class="row mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  {{ form.name.label(class="form-label") }}
                  {{ form.name(class="form-control") }}
                  {% if form.name.errors %}
                  <div class="text-danger">
                    {% for error in form.name.errors %}
                    <small>{{ error }}</small>
                    {% endfor %}
                  </div>
                  {% endif %}
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="form-group">
                  {{ form.reference_number.label(class="form-label") }}
                  {{ form.reference_number(class="form-control", placeholder="Auto-generated if left empty") }}
                  {% if form.reference_number.errors %}
                  <div class="text-danger">
                    {% for error in form.reference_number.errors %}
                    <small>{{ error }}</small>
                    {% endfor %}
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
            
            <div class="row mb-3">
              <div class="col-md-4">
                <div class="form-group">
                  {{ form.amount.label(class="form-label") }}
                  {{ form.amount(class="form-control") }}
                  {% if form.amount.errors %}
                  <div class="text-danger">
                    {% for error in form.amount.errors %}
                    <small>{{ error }}</small>
                    {% endfor %}
                  </div>
                  {% endif %}
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="form-group">
                  {{ form.currency.label(class="form-label") }}
                  {{ form.currency(class="form-select") }}
                  {% if form.currency.errors %}
                  <div class="text-danger">
                    {% for error in form.currency.errors %}
                    <small>{{ error }}</small>
                    {% endfor %}
                  </div>
                  {% endif %}
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="form-group">
                  {{ form.interest_rate.label(class="form-label") }}
                  <div class="input-group">
                    {{ form.interest_rate(class="form-control") }}
                    <span class="input-group-text">%</span>
                  </div>
                  {% if form.interest_rate.errors %}
                  <div class="text-danger">
                    {% for error in form.interest_rate.errors %}
                    <small>{{ error }}</small>
                    {% endfor %}
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
            
            <div class="row mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  {{ form.start_date.label(class="form-label") }}
                  {{ form.start_date(class="form-control", type="date") }}
                  {% if form.start_date.errors %}
                  <div class="text-danger">
                    {% for error in form.start_date.errors %}
                    <small>{{ error }}</small>
                    {% endfor %}
                  </div>
                  {% endif %}
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="form-group">
                  {{ form.maturity_date.label(class="form-label") }}
                  {{ form.maturity_date(class="form-control", type="date") }}
                  {% if form.maturity_date.errors %}
                  <div class="text-danger">
                    {% for error in form.maturity_date.errors %}
                    <small>{{ error }}</small>
                    {% endfor %}
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
            
            <div class="row mb-3">
              <div class="col-md-12">
                <div class="form-group">
                  {{ form.description.label(class="form-label") }}
                  {{ form.description(class="form-control", rows=3) }}
                  {% if form.description.errors %}
                  <div class="text-danger">
                    {% for error in form.description.errors %}
                    <small>{{ error }}</small>
                    {% endfor %}
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
            
            <div class="row mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  {{ form.counterparty.label(class="form-label") }}
                  {{ form.counterparty(class="form-control") }}
                  {% if form.counterparty.errors %}
                  <div class="text-danger">
                    {% for error in form.counterparty.errors %}
                    <small>{{ error }}</small>
                    {% endfor %}
                  </div>
                  {% endif %}
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="form-group">
                  {{ form.interest_payment_frequency.label(class="form-label") }}
                  {{ form.interest_payment_frequency(class="form-select") }}
                  {% if form.interest_payment_frequency.errors %}
                  <div class="text-danger">
                    {% for error in form.interest_payment_frequency.errors %}
                    <small>{{ error }}</small>
                    {% endfor %}
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
            
            <div class="row mb-3">
              <div class="col-md-12">
                <div class="form-group">
                  {{ form.notes.label(class="form-label") }}
                  {{ form.notes(class="form-control", rows=3) }}
                  {% if form.notes.errors %}
                  <div class="text-danger">
                    {% for error in form.notes.errors %}
                    <small>{{ error }}</small>
                    {% endfor %}
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
            
            <div class="d-flex justify-content-between">
              <a href="{{ url_for('treasury.investment_list') }}" class="btn btn-outline-secondary">Cancel</a>
              <button type="submit" class="btn btn-primary">
                {% if is_new %}Create Investment{% else %}Update Investment{% endif %}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Date validation
  document.getElementById('investment-form').addEventListener('submit', function(e) {
    const startDate = new Date(document.getElementById('start_date').value);
    const maturityDate = new Date(document.getElementById('maturity_date').value);
    
    if (maturityDate <= startDate) {
      e.preventDefault();
      alert('Maturity date must be after the start date.');
    }
  });
  
  // Update interest payment frequency based on investment type
  document.getElementById('investment_type').addEventListener('change', function() {
    const investmentType = this.value;
    const interestFrequencySelect = document.getElementById('interest_payment_frequency');
    
    // Example logic - adjust based on your business rules
    if (investmentType === 'CERTIFICATE_OF_DEPOSIT' || investmentType === 'BOND') {
      // CDs and bonds often have specific payment schedules
      interestFrequencySelect.value = 'SEMI_ANNUAL';
    } else if (investmentType === 'MONEY_MARKET') {
      // Money market funds typically compound daily but pay monthly
      interestFrequencySelect.value = 'MONTHLY';
    }
  });
</script>
{% endblock %}